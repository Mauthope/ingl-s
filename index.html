<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aprendizado de Palavras e Frases</title>
  <style>
    .button {
      margin: 5px;
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }

    .button:disabled {
      background-color: #ccc;
    }

    .word {
      margin: 10px;
      padding: 5px;
      background-color: #f0f0f0;
      cursor: pointer;
    }

    #wordModal {
      display: none;
      position: fixed;
      z-index: 1;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.4);
      overflow: auto;
    }

    .modal-content {
      background-color: #fff;
      margin: 15% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
    }

    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
      cursor: pointer;
    }

    #learnedWordsList {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <div>
    <button id="phraseBtn" class="button">Mostrar Frases</button>
    <button id="readPhraseBtn" class="button">Leitura de Frase</button>
    <button id="translateBtn" class="button" disabled>Traduzir</button>
    <button id="getPhraseBtn" class="button" disabled>Mostrar Tradução</button>
  </div>

  <div id="wordsContainer"></div>
  <div id="translationContainer"></div>
  <div id="phraseContainer"></div>
  <div id="learnedWordsList"></div>

  <!-- Modal -->
  <div id="wordModal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <p id="modalWord"></p>
      <p id="modalTranslation"></p>
      <p id="modalPhrase"></p>
    </div>
  </div>

  <script>
    let wordsData = [];
    let phrasesData = [];
    let currentWordsIndexes = [];
    let learnedWords = JSON.parse(localStorage.getItem('learnedWords')) || [];
    let readPhrasesIndex = 0;

    function loadExcelFile(fileName) {
      fetch(fileName)
        .then(response => response.text())
        .then(data => {
          let rows = data.split('\n');
          if (fileName === 'ingles.xlsx') {
            wordsData = rows.map(row => row.split('\t'));
            displayWords();
          } else if (fileName === 'voz.xlsx') {
            phrasesData = rows.map(row => row.split('\t'));
            displayPhrases();
          }
        })
        .catch(error => console.error('Erro ao carregar o arquivo:', error));
    }

    function displayWords() {
      currentWordsIndexes = getRandomUnusedIndexes();
      let wordsContainer = document.getElementById('wordsContainer');
      wordsContainer.innerHTML = '';
      currentWordsIndexes.forEach(index => {
        let wordDiv = document.createElement('div');
        wordDiv.className = 'word';
        wordDiv.textContent = wordsData[index][0];
        wordDiv.addEventListener('click', () => showModal(index));
        wordsContainer.appendChild(wordDiv);
      });
      document.getElementById('translateBtn').disabled = false;
    }

    function displayPhrases() {
      let phraseContainer = document.getElementById('phraseContainer');
      phraseContainer.innerHTML = '';
      currentWordsIndexes.forEach(index => {
        let phraseDiv = document.createElement('div');
        phraseDiv.className = 'word';
        phraseDiv.textContent = phrasesData[index][2];
        phraseContainer.appendChild(phraseDiv);
      });
    }

    function showModal(index) {
      let modal = document.getElementById('wordModal');
      document.getElementById('modalWord').textContent = wordsData[index][0];
      document.getElementById('modalTranslation').textContent = wordsData[index][1];
      document.getElementById('modalPhrase').textContent = phrasesData[index][2];
      modal.style.display = 'block';
      document.querySelector('.close').onclick = () => {
        modal.style.display = 'none';
      };
    }

    function getRandomUnusedIndexes() {
      let unusedIndexes = [];
      for (let i = 0; i < wordsData.length; i++) {
        if (!learnedWords.includes(wordsData[i][0])) {
          unusedIndexes.push(i);
        }
      }
      return unusedIndexes;
    }

    // Função para iniciar a leitura das frases
    function readPhrases() {
      if (readPhrasesIndex < currentWordsIndexes.length) {
        let index = currentWordsIndexes[readPhrasesIndex];
        let phrase = phrasesData[index][2];
        speakPhrase(phrase);
        learnedWords.push(phrase);
        localStorage.setItem('learnedWords', JSON.stringify(learnedWords));
        readPhrasesIndex++;
        setTimeout(readPhrases, 2000); // Leitura após 2 segundos
      } else {
        alert('Fim do ciclo de frases.');
        readPhrasesIndex = 0; // Reinicia o ciclo
      }
    }

    // Função para falar a frase
    function speakPhrase(phrase) {
      let utterance = new SpeechSynthesisUtterance(phrase);
      utterance.lang = 'pt-BR'; // Define o idioma para português
      speechSynthesis.speak(utterance);
    }

    // Ação dos botões
    document.getElementById('phraseBtn').addEventListener('click', displayPhrases);
    document.getElementById('readPhraseBtn').addEventListener('click', readPhrases);
    document.getElementById('translateBtn').disabled = true;
    document.getElementById('getPhraseBtn').disabled = true;

    loadExcelFile('ingles.xlsx');  // Carrega as palavras inicialmente
    loadExcelFile('voz.xlsx');  // Carrega as frases posteriormente
  </script>

</body>
</html>
